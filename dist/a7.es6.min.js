export var a7=a7;(a7=function(){"use strict";return{init:function(e,t,n){var o,r,i;e.model=void 0!==e.model?e.model:"object"==typeof gadgetui?"gadgetui":"",""===e.model&&n("No model specified."),(o=new Promise(function(t,n){a7.log.trace("a7 - model init"),a7.model.init(e,t,n)})).then(function(){a7.model.set("a7",{auth:{sessionTimeout:e.auth.sessionTimeout||9e5},console:{enabled:e.console.enabled||!1,wsServer:e.console.wsServer||"",top:e.console.top||100,left:e.console.left||100,width:e.console.width||500,height:e.console.height||300},logging:{logLevel:e.logging.logLevel||"ERROR,FATAL,INFO"},model:e.model,remote:{loginURL:e.remote.loginURL||"",refreshURL:e.remote.refreshURL||"",useTokens:e.auth.useTokens||!0},ui:{renderer:"object"==typeof Mustache?"Mustache":"object"==typeof Handlebars?"Handlebars":"",templates:e.ui.templates||void 0},ready:!1,user:""})}).then(function(){(r=new Promise(function(e,t){a7.model.get("a7.console").enabled?(a7.log.trace("a7 - console init"),a7.console.init(e,t)):e()})).then(function(){a7.log.trace("a7 - log init"),a7.log.init(),a7.log.trace("a7 - security init"),a7.security.init(),a7.log.trace("a7 - remote init"),a7.remote.init(e.remote.modules),a7.log.trace("a7 - events init"),a7.events.init(),new Promise(function(e,t){a7.log.trace("a7 - layout init"),a7.ui.init(e,t)}).then(function(){(i=new Promise(function(e,t){a7.log.trace("a7 - isSecured"),a7.security.isAuthenticated(e,t)})).then(function(e){a7.log.info("Authenticated: "+e+"..."),a7.log.info("Init complete..."),t({secure:e})}),i.catch(function(e){a7.log.error(e),n()})})}),r.catch(function(e){a7.log.error(e),n()})}),o.catch(function(e){a7.log.error(e),n()})}}}()).console=function(){"use strict";var e,t=function(t,n,o,r){var i=document.createElement("div");i.setAttribute("class","a7-console-row-"+o),void 0!==r&&(i.innerHTML=r+": ",i.setAttribute("class",i.getAttribute("class")+" a7-console-row-"+r)),i.innerHTML+=+(n.getHours()<10?"0"+n.getHours():n.getHours())+":"+(n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes())+": "+t,e.appendChild(i)};return{init:function(n,o){var r=a7.model.get("a7.console");if(r.enabled){var i;if(!0,(e=document.createElement("div")).setAttribute("id","consoleDiv"),e.setAttribute("class","a7-console"),document.body.append(e),a7.components.Constructor(gadgetui.display.FloatingPane,[e,{width:r.width,left:r.left,height:r.height,title:"Console Window",top:r.top,enableShrink:!1,enableClose:!0}],!1).selector.setAttribute("right",0),window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket)return void e.innerHTML("Your browser doesn't support WebSockets.");(i=new WebSocket(r.wsServer)).onopen=function(){},i.onerror=function(){var e="Can't connect to the console socket server.";r.enabled?t(e,new Date,"local"):a7.log.error(e)},i.onmessage=function(e){var n,o;try{n=JSON.parse(e.data)}catch(t){return void a7.log.error("This doesn't look like valid JSON: ",e.data)}if("history"===n.type)for(o=0;o<n.data.length;o++)t(n.data[o].text,new Date(n.data[o].time),"websocket");else"message"===n.type?t(n.data.text,new Date(n.data.time),"websocket"):a7.log.error("This doesn't look like valid JSON: ",n)},window.addEventListener("close",function(){i.close()}),a7.console.addMessage=t,a7.log.info("Console initializing..."),n()}else o("Console init should not be called when console option is set to false.")}}}(),a7.error=function(){"use strict";return window.onerror=function(e,t,n,o,r){return a7.error.captureError(e,t,n,o,r),!1},{capture:function(){},captureError:function(e,t,n,o,r){if(e.toLowerCase().indexOf("script error")>-1)a7.log.error("Script Error: See Browser Console for Detail");else{var i=["Message: "+e,"URL: "+t,"Line: "+n,"Column: "+o,"Error object: "+JSON.stringify(r)].join(" - ");a7.log.error(i)}}}}(),a7.events=function(){"use strict";var e={},t=e.hasOwnProperty;return{subscribe:function(n,o){t.call(e,n)||(e[n]=[]);var r=e[n].push(o)-1;return{remove:function(){delete e[n][r]}}},init:function(){a7.events.subscribe("auth.login",function(e){a7.remote.invoke("auth.login",e)}),a7.events.subscribe("auth.refresh",function(e){a7.remote.invoke("auth.refresh",e)}),a7.events.subscribe("auth.sessionTimeout",function(){}),a7.events.subscribe("auth.invalidateSession",function(){})},publish:function(n,o){a7.log.trace("event: "+n),t.call(e,n)&&e[n].forEach(function(e){e(o||{})})}}}(),a7.log=function(){var e=!1,t=[],n="ERROR,FATAL,INFO",o=function(o,r){e&&n.indexOf(r)>=0||n.indexOf("ALL")>=0?a7.model.get("a7.console").enabled&&a7.console.addMessage(o,new Date,"local",r):e||t.push({message:o,level:r})};return{init:function(){n=a7.model.get("a7.logging").logLevel,e=!0,t.forEach(function(e){o(e.message,e.level)}),a7.log.info("Log initializing...")},error:function(e){o(e,"ERROR")},fatal:function(e){o(e,"FATAL")},info:function(e){o(e,"INFO")},trace:function(e){o(e,"TRACE")},warn:function(e){o(e,"WARN")}}}(),a7.model=function(){"use strict";var e,t={};return{create:function(){return t.create.apply(e,arguments)},destroy:function(){return t.destroy.apply(e,arguments)},get:function(){return t.get.apply(e,arguments)},set:function(){return t.set.apply(e,arguments)},exists:function(){return t.exists.apply(e,arguments)},bind:function(){return t.bind.apply(e,arguments)},init:function(n,o){switch(a7.log.info("Model initializing... "),n.model){case"gadgetui":e=gadgetui.model,Object.keys(gadgetui.model).forEach(function(e){"BindableObject"!==e&&(t[e]=gadgetui.model[e])})}o()}}}(),a7.components=function(){"use strict";var e={on:function(e,t){return void 0===this.events[e]&&(this.events[e]=[]),this.events[e].push(t),this},off:function(e){return this.events[e]=[],this},fireEvent:function(e,t){var n=this;this.events[e].forEach(function(e){e(n,t)})},getAll:function(){return[{name:"on",func:this.on},{name:"off",func:this.off},{name:"fireEvent",func:this.fireEvent}]}};function t(){return this}return t.prototype.getMemento=function(){var e={},t=this;return Object.keys(this).forEach(function(n){e[n]=t[n]}),e},{Constructor:function(t,n,o){var r,i;return!0===o&&e.getAll().forEach(function(e){void 0===t.prototype[e]&&(t.prototype[e]=e.func)}),i=Object.create(t.prototype),void 0===(r=t.apply(i,n))&&(r=i),!0===o&&(r.events={},void 0!==t.prototype.events&&t.prototype.events.forEach(function(e){r.events[e]=[]})),r},EventBindings:e,User:t}}(),a7.remote=function(){var e,t,n={},o=new Date,r={},i=function(e,t){r[e]=t};return{getToken:function(){return e},getSessionTimer:function(){return t},init:function(t){(n=a7.model.get("a7.remote")).sessionTimeout=a7.model.get("a7.auth").sessionTimeout,n.useTokens&&sessionStorage.token&&""!==sessionStorage.token&&(e=sessionStorage.token),i("auth",{login:function(t){var o,r={method:"POST",headers:{Authorization:"Basic "+a7.util.base64.encode64(t.username+":"+t.password)}};o=new Request(n.loginURL,r),fetch(o).then(function(t){var n=t.headers.get("X-Token");return void 0!==n&&null!==n&&(e=n,sessionStorage.token=n),t.json()}).then(function(e){var n=a7.model.get("a7.user");Object.keys(e.user).map(function(t){n[t]=e.user[t]}),sessionStorage.user=JSON.stringify(n),a7.model.set("a7.user",n),void 0!==t.callback&&t.callback(e)})},refresh:function(e){a7.remote.fetch(n.refreshURL,{},!0).then(function(e){return e.json()}).then(function(t){void 0!==e.resolve&&e.resolve(t.success)})}}),Object.keys(t).forEach(function(e){i(e,t[e])})},fetch:function(r,i,a){var s,c;if(a7.log.info("fetch: "+r),a&&n.useTokens){var u=new Date,l=Math.abs(u-o);if(Math.floor(l/1e3/60)>n.sessionTimeout)return void a7.events.publish("auth.sessionTimeout");void 0!==e&&null!==e&&(void 0===i.headers?i.headers={"X-Token":e}:i.headers["X-Token"]=e),o=u}return s=new Request(r,i),(c=fetch(s)).then(function(o){if(a&&n.useTokens){var r=o.headers.get("X-Token");void 0!==r&&null!==r?(e=r,sessionStorage.token=r,void 0!==t&&clearTimeout(t),t=setTimeout(function(){a7.remote.invoke("auth.refresh")},n.sessionTimeout)):a7.events.publish("auth.sessionTimeout")}}),c},invoke:function(e,t){var n=e.split(".");n.length<2?a7.log.error("No action specified. Valid actions are: "+Object.keys(r[n[0]]).toString()):"function"==typeof r[n[0]][n[1]]&&r[n[0]][n[1]](t)}}}(),a7.security=function(){"use strict";return{isAuthenticated:function(e,t){if(a7.log.info("Checking authenticated state.. "),a7.model.get("a7.remote.useTokens")){var n=a7.remote.getToken();void 0!==n&&null!==n&&n.length>0?void 0===a7.remote.getSessionTimer()?(a7.log.info("Refreshing user..."),a7.events.publish("auth.refresh",{resolve:e,reject:t})):e(!0):e(!1)}},init:function(){a7.log.info("Security initializing...");var e,t=a7.components.Constructor(a7.components.User,[],!0);sessionStorage.user&&""!==sessionStorage.user&&(e=JSON.parse(sessionStorage.user),Object.keys(e).map(function(n){t[n]=e[n]})),a7.model.set("a7.user",t)}}}(),a7.ui=function(){"use strict";var e={},t={},n={},o=[],r=function(t){var o=Math.ceil(500*Math.random());switch(e.renderer){case"Mustache":case"Handlebars":fetch(e.templates+"?"+o).then(function(e){return e.text()}).then(function(o){a7.log.info("Loading "+e.renderer+" templates... "),(new DOMParser).parseFromString(o,"text/html").querySelectorAll("script").forEach(function(t){!function(t,o){switch(e.renderer){case"Mustache":n[t]=o.trim();break;case"Handlebars":n[t]=Handlebars.compile(o.trim())}}(t.getAttribute("id"),t.innerHTML)}),t()})}};return{render:function(t,o,r){switch(e.renderer){case"Mustache":return Mustache.render(n[t],o,r);case"Handlebars":return n[t](o)}},selectors:t,getSelector:function(e){return t[e]},setSelector:function(e,n){t[e]=n},setView:function(e,t){o[e]=t},getView:function(e){return o[e]},removeView:function(e){delete o[e]},getTemplate:function(e){return n[e]},init:function(t,n){e=a7.model.get("a7.ui"),a7.log.info("Layout initializing..."),"Handlebars,Mustache".indexOf(e.renderer)>=0?(a7.model.set("a7.ui.templatesLoaded",!1),void 0!==e.templates&&r(t)):t()}}}(),a7.util={split:function(e){return e.split(/,\s*/)},extractLast:function(e){return this.split(e).pop()},base64:{keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(e){if(!String(e).length)return!1;var t,n,o,r,i,a,s,c="",u=0;do{r=(t=e.charCodeAt(u++))>>2,i=(3&t)<<4|(n=e.charCodeAt(u++))>>4,a=(15&n)<<2|(o=e.charCodeAt(u++))>>6,s=63&o,isNaN(n)?a=s=64:isNaN(o)&&(s=64),c=c+this.keyStr.charAt(r)+this.keyStr.charAt(i)+this.keyStr.charAt(a)+this.keyStr.charAt(s)}while(u<e.length);return c},decode64:function(e){if(!e)return!1;var t,n,o,r,i,a,s="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=this.keyStr.indexOf(e.charAt(c++))<<2|(r=this.keyStr.indexOf(e.charAt(c++)))>>4,n=(15&r)<<4|(i=this.keyStr.indexOf(e.charAt(c++)))>>2,o=(3&i)<<6|(a=this.keyStr.indexOf(e.charAt(c++))),s+=String.fromCharCode(t),64!==i&&(s+=String.fromCharCode(n)),64!==a&&(s+=String.fromCharCode(o))}while(c<e.length);return s}},leadingZero:function(e){return e<10?"0"+e:e},dynamicSort:function(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,o){return(n[e]<o[e]?-1:n[e]>o[e]?1:0)*t}},yesNo:function(e){return parseInt(e,10)<1?"No":"Yes"},isValidDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},id:function(){return((100*Math.random()).toString()+(100*Math.random()).toString()).replace(/\./g,"")},tryCatch:function(e,t,n){var o={value:null};try{return e.apply(t,n)}catch(e){return o.value=e,o}},getNumberValue:function(e){return isNaN(Number(e))?Number(e.substring(0,e.length-2)):e},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getOffset:function(e){var t=e.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}}};
//# sourceMappingURL=a7.es6.min.js.map