export var a7=a7;(a7=function(){"use strict";return{init:function(e,t,o){var n,r,i;e.model=void 0!==e.model?e.model:"altseven",""===e.model&&o("A model is required, but no model was specified.");var s={auth:{sessionTimeout:e.auth&&e.auth.sessionTimeout?e.auth.sessionTimeout:9e5},console:e.console?{enabled:e.console.enabled||!1,wsServer:e.console.wsServer||"",container:e.console.container||("object"==typeof gadgetui?gadgetui.display.FloatingPane:""),top:e.console.top||100,left:e.console.left||500,width:e.console.width||500,height:e.console.height||300}:{},logging:{logLevel:e.logging&&e.logging.logLevel?e.logging.logLevel:"ERROR,FATAL,INFO",toBrowserConsole:!(!e.logging||!e.logging.toBrowserConsole)&&e.logging.toBrowserConsole},model:e.model,remote:e.remote?{loginURL:e.remote.loginURL||"",logoutURL:e.remote.logoutURL||"",refreshURL:e.remote.refreshURL||"",useTokens:!e.auth||!e.auth.useTokens||e.auth.useTokens}:{useTokens:!0},ui:{renderer:e.ui?e.ui.renderer||("object"==typeof Mustache?"Mustache":"object"==typeof Handlebars?"Handlebars":"templateLiterals"):"templateLiterals"},ready:!1,user:""};(n=new Promise(function(e,t){a7.log.trace("a7 - model init"),a7.model.init(s,e,t)})).then(function(){a7.model.set("a7",s)}).then(function(){(r=new Promise(function(e,t){a7.model.get("a7").console.enabled?(a7.log.trace("a7 - console init"),a7.console.init(s,e,t)):e()})).then(function(){a7.log.trace("a7 - log init"),a7.log.init(),a7.log.trace("a7 - security init"),a7.security.init(),a7.log.trace("a7 - remote init"),a7.remote.init(e.remote&&e.remote.modules?e.remote.modules:{}),a7.log.trace("a7 - events init"),a7.events.init(),new Promise(function(e,t){a7.log.trace("a7 - layout init"),a7.ui.init(e,t)}).then(function(){(i=new Promise(function(e,t){a7.log.trace("a7 - isSecured"),a7.security.isAuthenticated(e,t)})).then(function(e){a7.error.init(),a7.log.info("Authenticated: "+e+"..."),a7.log.info("Init complete..."),t({secure:e})}),i.catch(function(e){a7.log.error(e),o()})})}),r.catch(function(e){a7.log.error(e),o()})}),n.catch(function(e){a7.log.error(e),o()})}}}()).console=function(){"use strict";var e,t=function(t,o,n,r){var i=document.createElement("div");i.setAttribute("class","a7-console-row-"+n),void 0!==r&&(i.innerHTML=r+": ",i.setAttribute("class",i.getAttribute("class")+" a7-console-row-"+r)),i.innerHTML+=+(o.getHours()<10?"0"+o.getHours():o.getHours())+":"+(o.getMinutes()<10?"0"+o.getMinutes():o.getMinutes())+": "+t,e.appendChild(i)},o=function(e,o){var n=0;if("history"===o.type)for(n=0;n<o.data.length;n++)t(o.data[n].text,new Date(o.data[n].time),"websocket");else"message"===o.type?t(o.data.text,new Date(o.data.time),"websocket"):a7.log.error("This doesn't look like valid JSON: ",o)};return{init:function(n,r,i){var s=n.console;if(""===s.container&&i("You must specify a container object for the console display."),s.enabled){if(!0,(e=document.createElement("div")).setAttribute("id","consoleDiv"),e.setAttribute("class","a7-console"),document.body.append(e),a7.components.Constructor(s.container,[e,{width:s.width,left:s.left,height:s.height,title:"Console Window",top:s.top,enableShrink:!1,enableClose:!0}],!1).selector.setAttribute("right",0),s.wsServer)a7.remote.webSocket(s.wsServer,o);a7.console.addMessage=t,a7.log.info("Console initializing..."),r()}else i("Console init should not be called when console option is set to false.")}}}(),a7.error=function(){"use strict";var e={};return window.onerror=function(e,t,o,n,r){return a7.error.captureError(e,t,o,n,r),!1},{events:{scriptError:[]},capture:function(){},captureError:function(e,t,o,n,r){if(e.toLowerCase().indexOf("script error")>-1)a7.log.error("Script Error: See Browser Console for Detail");else{var i=["Message: "+e,"URL: "+t,"Line: "+o,"Column: "+n,"Error object: "+JSON.stringify(r)].join(" - ");a7.error.fireEvent("scriptError",[e,t,o,n,r]),a7.log.error(i)}},init:function(){a7.components.EventBindings.getAll().forEach(function(t){void 0===e[t]&&(e[t.name]=t.func),a7.error.on=e.on,a7.error.off=e.off,a7.error.fireEvent=e.fireEvent})}}}(),a7.events=function(){"use strict";var e={},t=e.hasOwnProperty;return{subscribe:function(o,n){t.call(e,o)||(e[o]=[]);var r=e[o].push(n)-1;return{remove:function(){delete e[o][r]}}},init:function(){a7.events.subscribe("auth.login",function(e){a7.remote.invoke("auth.login",e)}),a7.events.subscribe("auth.logout",function(e){a7.remote.invoke("auth.logout",e)}),a7.events.subscribe("auth.refresh",function(e){a7.remote.invoke("auth.refresh",e)}),a7.events.subscribe("auth.sessionTimeout",function(){}),a7.events.subscribe("auth.invalidateSession",function(){})},publish:function(o,n){a7.log.trace("event: "+o),t.call(e,o)&&e[o].forEach(function(e){e(n||{})})}}}(),a7.log=function(){var e=!1,t=!1,o=!1,n=[],r="ERROR,FATAL,INFO",i=function(i,s){e&&r.indexOf(s)>=0||r.indexOf("ALL")>=0?(o&&a7.console.addMessage(i,new Date,"local",s),t&&console.log(i)):e||n.push({message:i,level:s})};return{init:function(){r=a7.model.get("a7").logging.logLevel,t=a7.model.get("a7").logging.toBrowserConsole,o=a7.model.get("a7").console.enabled,e=!0,n.forEach(function(e){i(e.message,e.level)}),a7.log.info("Log initializing...")},error:function(e){i(e,"ERROR")},fatal:function(e){i(e,"FATAL")},info:function(e){i(e,"INFO")},trace:function(e){i(e,"TRACE")},warn:function(e){i(e,"WARN")}}}(),a7.model=function(){"use strict";var e,t={};return{destroy:function(){return t.destroy.apply(e,arguments)},get:function(){return t.get.apply(e,arguments)},set:function(){return t.set.apply(e,arguments)},exists:function(){return t.exists.apply(e,arguments)},init:function(o,n){if(a7.log.info("Model initializing... "),"string"==typeof o.model)switch(o.model){case"altseven":(e=a7.components.Model).init(o);break;case"gadgetui":e=gadgetui.model}else"object"==typeof o.model&&(e=o.model);a7.log.trace("Model set: "+e),Object.keys(e).forEach(function(o){t[o]=e[o]}),n()}}}(),a7.components=function(){"use strict";var e,t,o,n,r,i,s,a={on:function(e,t){return void 0===this.events[e]&&(this.events[e]=[]),this.events[e].push(t),this},off:function(e){return this.events[e]=[],this},fireEvent:function(e,t){var o=this;void 0!==this.events[e]&&this.events[e].forEach(function(e){e(o,t)})},getAll:function(){return[{name:"on",func:this.on},{name:"off",func:this.off},{name:"fireEvent",func:this.fireEvent}]}},c=(e={},t=[],o=20,n=0,r=function(e){return JSON.parse(JSON.stringify(t[e]))},i=function(){a7.log.trace("Set memento"),n<t.length-1&&(t=t.slice(0,n)),t.length===o&&(a7.log.trace("model - moving an item off the stack history."),t.shift()),t.push(JSON.parse(JSON.stringify(e))),n=t.length-1},s=function(e){n=e<0?0:e>t.length-1?t.length-1:e},{undo:function(t){!function(e){e=void 0!==e?e:1,a7.log.trace("Move back in history index by "+e+" operations "),s(n-e)}(t),e=r(n)},redo:function(t){!function(e){e=void 0!==e?e:1,a7.log.trace("Move forward in history index by "+e+" operations "),s(n+e)}(t),e=r(n)},init:function(e){o=void 0!==e&&void 0!==e.maxEntries?e.maxEntries:20},destroy:function(t){i(),delete e[t]},exists:function(t){return o=t,e.hasOwnProperty(o);var o},get:function(t){try{return JSON.parse(JSON.stringify(e[t]))}catch(e){throw a7.log.error(e),e}},set:function(t,o){!function(t,o){switch(a7.log.trace("Set key: "+t+" = "+JSON.stringify(o)),typeof o){case"undefined":case"number":case"boolean":case"function":case"Symbol":case"string":e[t]=o;break;case"object":e[t]=null===o?null:JSON.parse(JSON.stringify(o))}i()}(t,o)}});function u(){return this}function l(e){this.renderer=a7.model.get("a7").ui.renderer,this.type="View",this.props=e,this.state={},this.config()}return u.prototype.getMemento=function(){var e={},t=this;return Object.keys(this).forEach(function(o){e[o]=t[o]}),e},l.prototype={config:function(){this.on("mustRegister",function(e,t){a7.log.trace("mustRegister: "+this.props.id+", parent: "+t.props.id),this.props.parentID=t.props.id,a7.ui.register(this)}.bind(this)),this.on("mustRender",function(){a7.ui.enqueueForRender(this.props.id)}.bind(this)),this.on("rendered",function(){this.onRendered()}.bind(this)),this.on("registered",function(){if(void 0!==this.props)for(var e in this.props)null!==this.props[e]&&void 0!==this.props[e].type&&"View"===this.props[e].type&&void 0===a7.ui.getView(this.props[e].props.id)&&(a7.log.trace("parent: "+this.props.id+", register child: "+this.props[e].props.id),this.props[e].fireEvent("mustRegister",Object.assign(this)));void 0===this.props.parentID&&this.fireEvent("mustRender")}.bind(this))},events:["mustRender","rendered","mustRegister","registered"],setState:function(e){this.state=e,this.fireEvent("mustRender")},render:function(){if(a7.log.info("render: "+this.props.id),void 0!==this.props.element&&null!==this.props.element||(this.props.element=document.querySelector(this.props.selector)),!this.props.element)throw"You must define a selector for the view.";this.props.element.innerHTML="function"==typeof this.template?this.template():this.template;var e=[];a7.ui.getEvents().forEach(function(t){e.push("[data-on"+t+"]")}),this.props.element.querySelectorAll(e.toString()).forEach(function(e){for(var t=0;t<e.attributes.length;t++){var o=e.attributes[t];if(o.name.startsWith("data-on")){var n=o.name.substring(7,o.name.length);e.addEventListener(n,this.eventHandlers[e.attributes["data-on"+n].value])}}}.bind(this)),this.fireEvent("rendered")},onRendered:function(){if(void 0!==this.props)for(var e in this.props)void 0!==this.props[e].type&&"View"===this.props[e].type&&(this.props[e].props.element=document.querySelector(this.props[e].props.selector),this.props[e].render())}},{Constructor:function(e,t,o){var n,r;return!0===o&&a.getAll().forEach(function(t){void 0===e.prototype[t]&&(e.prototype[t.name]=t.func)}),r=Object.create(e.prototype),!0===o&&(r.events={},void 0!==e.prototype.events&&e.prototype.events.forEach(function(e){r.events[e]=[]})),void 0===(n=e.apply(r,t))&&(n=r),n},EventBindings:a,Model:c,User:u,View:l}}(),a7.remote=function(){var e,t,o={},n=new Date,r={},i=function(e,t){r[e]=t};return{webSocket:function(e,t,o){if(e){if(window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket)return void a7.log.error("Your browser doesn't support WebSockets.");let n=new WebSocket(e);return n.onopen=function(){a7.log.info("Connecting to the socket server at "+e)},n.onerror=function(){var t="Can't connect to the socket server at "+e;a7.log.error(t)},n.onmessage=function(e){if(o){var n;try{n=JSON.parse(e.data)}catch(t){return void a7.log.error("This doesn't look like valid JSON: ",e.data)}t(e,n)}else t(e)},window.addEventListener("close",function(){n.close()}),n}},getToken:function(){return e},getSessionTimer:function(){return t},init:function(t){var n=a7.model.get("a7").auth;(o=a7.model.get("a7").remote).sessionTimeout=n.sessionTimeout,o.useTokens&&sessionStorage.token&&""!==sessionStorage.token&&(e=sessionStorage.token),i("auth",{login:function(t){a7.log.trace("remote call: auth.login");var n,r={method:"POST",headers:{Authorization:"Basic "+a7.util.base64.encode64(t.username+":"+t.password)}};n=new Request(o.loginURL,r),fetch(n).then(function(t){var o=t.headers.get("X-Token");return void 0!==o&&null!==o&&(e=o,sessionStorage.token=o),t.json()}).then(function(e){var o=a7.model.get("user");Object.keys(e.user).map(function(t){o[t]=e.user[t]}),sessionStorage.user=JSON.stringify(o),a7.model.set("user",o),void 0!==t.callback&&t.callback(e)})},logout:function(t){a7.log.trace("remote call: auth.logout");var n,r={method:"POST",headers:{Authorization:"Basic "+a7.util.base64.encode64(t.username+":"+t.password)}};n=new Request(o.logoutURL,r),fetch(n).then(function(t){return e="",sessionStorage.token="",t.json()}).then(function(e){var o=a7.components.Constructor(a7.components.User,[],!0);sessionStorage.user=JSON.stringify(o),a7.model.set("user",o),void 0!==t.callback&&t.callback()})},refresh:function(e){a7.remote.fetch(o.refreshURL,{},!0).then(function(e){return e.json()}).then(function(t){void 0!==e.resolve&&e.resolve(t.success)})}}),Object.keys(t).forEach(function(e){i(e,t[e])})},fetch:function(r,i,s){var a,c;if(a7.log.info("fetch: "+r),s&&o.useTokens){var u=new Date,l=Math.abs(u-n);if(Math.floor(l/1e3/60)>o.sessionTimeout)return void a7.events.publish("auth.sessionTimeout");void 0!==e&&null!==e&&(void 0===i.headers?i.headers={"X-Token":e}:i.headers["X-Token"]=e),n=u}return a=new Request(r,i),(c=fetch(a)).then(function(n){if(s&&o.useTokens){var r=n.headers.get("X-Token");void 0!==r&&null!==r?(e=r,sessionStorage.token=r,void 0!==t&&clearTimeout(t),t=setTimeout(function(){a7.remote.invoke("auth.refresh")},o.sessionTimeout)):a7.events.publish("auth.sessionTimeout")}}),c},invoke:function(e,t){var o=e.split(".");o.length<2?a7.log.error("No action specified. Valid actions are: "+Object.keys(r[o[0]]).toString()):"function"==typeof r[o[0]][o[1]]&&r[o[0]][o[1]](t)}}}(),a7.security=function(){"use strict";return{isAuthenticated:function(e,t){if(a7.log.info("Checking authenticated state.. "),a7.model.get("a7").remote.useTokens){var o=a7.remote.getToken();void 0!==o&&null!==o&&o.length>0?void 0===a7.remote.getSessionTimer()?(a7.log.info("Refreshing user..."),a7.events.publish("auth.refresh",{resolve:e,reject:t})):e(!0):e(!1)}},init:function(){a7.log.info("Security initializing...");var e,t=a7.components.Constructor(a7.components.User,[],!0);sessionStorage.user&&""!==sessionStorage.user&&(e=JSON.parse(sessionStorage.user),Object.keys(e).map(function(o){t[o]=e[o]})),a7.model.set("user",t)}}}(),a7.ui=function(){"use strict";const e=["cached","error","abort","load","beforeunload"].concat(["online","offline"]).concat(["focus","blur"]).concat(["open","message","error","close"]).concat(["pagehide","pageshow","popstate"]).concat(["animationstart","animationend","animationiteration"]).concat(["transitionstart","transitioncancel","transitionend","transitionrun"]).concat(["reset","submit"]).concat(["beforeprint","afterprint"]).concat(["compositionstart","compositionupdate","compositionend"]).concat(["fullscreenchange","fullscreenerror","resize","scroll"]).concat(["cut","copy","paste"]).concat(["keydown","keypress","keyup"]).concat(["auxclick","click","contextmenu","dblclick","mousedown","mousenter","mouseleave","mousemove","mouseover","mouseout","mouseup","pointerlockchange","pointerlockerror","wheel"]).concat(["drag","dragend","dragstart","dragleave","dragover","drop"]).concat(["audioprocess","canplay","canplaythrough","complete","durationchange","emptied","ended","loadeddata","loadedmetadata","pause","play","playing","ratechange","seeked","seeking","stalled","suspend","timeupdate","columechange","waiting"]).concat(["loadend","loadstart","progress","timeout"]).concat(["change","storage"]).concat(["checking","downloading","noupdate","obsolete","updateready"]).concat(["broadcast","CheckBoxStateChange","hashchange","input","RadioStateChange","readystatechange","ValueChange"]).concat(["invalid","localized","show"]);var t=[],o={},n={},r=[],i=[],s=!1,a=[],c=function(e){a7.log.trace("Find children of "+e);let t=[],o="",n=a[e].props;if(void 0!==n)for(o in n)null!==n[o]&&void 0!==n[o].type&&"View"===n[o].type&&(t.push(n[o].props.id),t.concat(c(n[o].props.id)));return t},u=function(e){if(s)i.push(e);else if(a7.log.info("enqueue: "+e),r.length){let t=c(e);if(void 0===a[e].props.parentID)a7.log.trace("add to front of queue: "+e),r.unshift(e);else{let t=function(e){a7.log.trace("Find parents of "+e);let t=[],o=a[e];for(;void 0!==o.props.parentID;)t.unshift(o.props.parentID),o=a[o.props.parentID];return t}(e),o=void 0;t.length&&(o=t.find(function(e){return r.indexOf(e)>=0})),void 0===o&&(a7.log.trace("add to end of queue: "+e),r.push(e))}t.forEach(function(e){r.indexOf(e)>=0&&(a7.log.trace("remove child from queue: "+e),r.splice(r.indexOf(e),1))})}else a7.log.trace("add first view to queue: "+e),r.push(e),setTimeout(l,18)},l=function(){a7.log.trace("processing the queue"),s=!0,r.forEach(function(e){a[e].render()}),r=[],s=!1,i.forEach(function(e){u(e)}),i=[]};return{getEvents:function(){return t},selectors:n,getSelector:function(e){return n[e]},setSelector:function(e,t){n[e]=t},getNode:function(e){return document.querySelector(e)},register:function(e){switch(o.renderer){case"Handlebars":case"Mustache":case"templateLiterals":a[e.props.id]=e,e.fireEvent("registered")}},getView:function(e){return a[e]},enqueueForRender:u,removeView:function(e){delete a[e]},views:a,init:function(n,r){switch(a7.log.info("Layout initializing..."),(o=a7.model.get("a7").ui).eventGroups?o.eventGroups:"standard"){case"extended":r("Extended events are not implemented yet.");case"standard":t=e;break;default:o.eventGroups.forEach(function(e){t=t.concat(e)})}n()}}}(),a7.util={split:function(e){return e.split(/,\s*/)},extractLast:function(e){return this.split(e).pop()},base64:{keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(e){if(!String(e).length)return!1;var t,o,n,r,i,s,a,c="",u=0;do{r=(t=e.charCodeAt(u++))>>2,i=(3&t)<<4|(o=e.charCodeAt(u++))>>4,s=(15&o)<<2|(n=e.charCodeAt(u++))>>6,a=63&n,isNaN(o)?s=a=64:isNaN(n)&&(a=64),c=c+this.keyStr.charAt(r)+this.keyStr.charAt(i)+this.keyStr.charAt(s)+this.keyStr.charAt(a)}while(u<e.length);return c},decode64:function(e){if(!e)return!1;var t,o,n,r,i,s,a="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=this.keyStr.indexOf(e.charAt(c++))<<2|(r=this.keyStr.indexOf(e.charAt(c++)))>>4,o=(15&r)<<4|(i=this.keyStr.indexOf(e.charAt(c++)))>>2,n=(3&i)<<6|(s=this.keyStr.indexOf(e.charAt(c++))),a+=String.fromCharCode(t),64!==i&&(a+=String.fromCharCode(o)),64!==s&&(a+=String.fromCharCode(n))}while(c<e.length);return a}},leadingZero:function(e){return e<10?"0"+e:e},dynamicSort:function(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(o,n){return(o[e]<n[e]?-1:o[e]>n[e]?1:0)*t}},yesNo:function(e){return parseInt(e,10)<1?"No":"Yes"},isValidDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},id:function(){return((100*Math.random()).toString()+(100*Math.random()).toString()).replace(/\./g,"")},tryCatch:function(e,t,o){var n={value:null};try{return e.apply(t,o)}catch(e){return n.value=e,n}},getNumberValue:function(e){return isNaN(Number(e))?Number(e.substring(0,e.length-2)):e},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getOffset:function(e){var t=e.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}}};
//# sourceMappingURL=a7.min.js.map